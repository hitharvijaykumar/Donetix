{% extends 'base.html' %}
{% block title %}NGO Dashboard{% endblock %}
{% block content %}
<h2>Available Donations</h2>
{% for donation in donations %}
    <div class="card">
        <p class="card-title">{{ donation.category }}</p>
        <p class="card-text">{{ donation.description }}</p>
        <p>Quantity: {{ donation.quantity }}</p>
        <p>Location: {{ donation.location }}</p>

        <!-- Show the 'Request' button only if donation is available -->
        {% if donation.available %}
            <form action="/request-donation/{{ donation.id }}/" method="post">
                {% csrf_token %}
                <input type="submit" value="Request">
            </form>
        {% endif %}

        <!-- Show chat button if the request is accepted -->
        {% for req in donation.request_set.all %}
            {% if req.ngo == user and req.accepted %}
                <a href="{% url 'chat' donation.donator.id %}">
                    <button>Chat with {{ donation.donator.username }}</button>
                </a>
            {% endif %}
        {% endfor %}
    </div>
{% empty %}
    <p>No donations available at the moment.</p>
{% endfor %}

{% endblock %}